var FoursquareUtil={apiKey:"",authUrl:"https://foursquare.com/",apiUrl:"https://api.foursquare.com/",redirectUrl:"",versionStr:null,appBrowser:null,init:function(a){if(a.apiKey){FoursquareUtil.apiKey=a.apiKey}if(a.authUrl){FoursquareUtil.authUrl=a.authUrl}if(a.apiUrl){FoursquareUtil.apiUrl=a.apiUrl}if(a.redirectUrl){FoursquareUtil.redirectUrl=a.redirectUrl}FoursquareUtil.refreshVersionStr()},refreshVersionStr:function(){var a=new Date(),c=a.getFullYear(),d=a.getMonth()+1,b=a.getDate();FoursquareUtil.versionStr="v="+c.toString()+d.toString()+b.toString()},checkTokenOnUrl:function(b){if(b.url.indexOf("access_token")!=-1){var a=FoursquareUtil.getAccessTokenFromUrl(b.url);TokenModel.init();TokenModel.saveToken(a);FoursquareUtil.appBrowser.close();window.open("home.html","_self")}},authenticateWithRedirect:function(){if(InternetConnection.checkConnectionExist()){var a=FoursquareUtil.authUrl+"oauth2/authenticate?client_id="+FoursquareUtil.apiKey+"&response_type=token&redirect_uri="+encodeURIComponent(FoursquareUtil.redirectUrl);FoursquareUtil.appBrowser=window.open(a,"_blank","location=no");FoursquareUtil.appBrowser.addEventListener("loadstart",FoursquareUtil.checkTokenOnUrl)}else{}},authorizeWithRedirect:function(){var a=FoursquareUtil.authUrl+"oauth2/authorize?client_id="+FoursquareUtil.apiKey+"&response_type=token&redirect_uri="+encodeURIComponent(FoursquareUtil.redirectUrl);window.location.href=a},getAccessTokenFromUrl:function(a){return $.url(a).fparam("access_token")},treatFoursquareApiResponse:function(b){var a=b.meta.code;switch(a){case 400:$(document).trigger("bad_request");break;case 401:$(document).trigger("unauthorized");break;case 403:$(document).trigger("forbidden");break;case 404:$(document).trigger("not_found");break;case 405:$(document).trigger("method_not_allowed");break;case 409:$(document).trigger("conflict");break;case 500:$(document).trigger("internal_server_error");break}return true},requestUserData:function(c,a){var b={};if(!a){a="self"}if(InternetConnection.checkConnectionExist()){$.ajax({url:FoursquareUtil.apiUrl+"v2/users/"+a+"?"+FoursquareUtil.versionStr+"&oauth_token="+c,type:"GET",beforeSend:function(){$.loader.start()},success:function(d){if(FoursquareUtil.treatFoursquareApiResponse(d)){b=d.response}},complete:function(){$.loader.stop()}})}else{}return b},requestUserFriends:function(c,a){var b={};if(!a){a="self"}if(InternetConnection.checkConnectionExist()){$.ajax({url:FoursquareUtil.apiUrl+"v2/users/"+a+"/friends?"+FoursquareUtil.versionStr+"&oauth_token="+c,type:"GET",beforeSend:function(){$.loader.start()},success:function(d){if(FoursquareUtil.treatFoursquareApiResponse(d)){b=d.response}},complete:function(){$.loader.stop()}})}else{}return b}};